Copy{% extends 'base.html' %}

{% block content %}
<div class="container mt-5">
    <h2 class="mb-4">Create Recipe</h2>
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="row">
            <!-- Recipe Details -->
            <div class="col-md-4 mb-4">
                <h3 class="mb-3">Recipe Details</h3>
                <div class="form-group mb-3">
                    <label for="{{ form.title.id_for_label }}">Title:</label>
                    {{ form.title }}
                </div>
                <div class="form-group mb-3">
                    <label for="{{ form.description.id_for_label }}">Description:</label>
                    {{ form.description }}
                </div>
                <div class="form-group mb-3">
                    <label for="{{ form.image.id_for_label }}">Image:</label>
                    {{ form.image }}
                </div>
                <div class="form-group mb-3">
                    <label for="{{ form.category.id_for_label }}">Category:</label>
                    {{ form.category }}
                </div>
            </div>

            <!-- Ingredients -->
            <div class="col-md-4 mb-4">
                <h3 class="mb-3">Ingredients</h3>
                {{ ingredient_formset.management_form }}
                <div id="ingredient-formset">
                    {% for ingredient_form in ingredient_formset %}
                        <div class="ingredient-form mb-3 p-2 border rounded">
                            <div class="form-group mb-2">
                                <label for="{{ ingredient_form.name.id_for_label }}">Name:</label>
                                {{ ingredient_form.name }}
                            </div>
                            <div class="form-group mb-2">
                                <label for="{{ ingredient_form.quantity.id_for_label }}">Quantity:</label>
                                {{ ingredient_form.quantity }}
                            </div>
                            <div class="form-group mb-2">
                                <label for="{{ ingredient_form.unit.id_for_label }}">Unit:</label>
                                {{ ingredient_form.unit }}
                            </div>
                            {{ ingredient_form.id }}
                            {{ ingredient_form.DELETE }}
                        </div>
                    {% endfor %}
                </div>
                <button type="button" id="add-ingredient" class="btn btn-secondary mt-2">Add Ingredient</button>
            </div>


<!-- Preparation Steps -->
<div class="col-md-4 mb-4">
    <h3 class="mb-3">Preparation Steps</h3>
    {{ step_formset.management_form }}
    <div id="step-formset" class="preparation-steps-container">
        {% for step_form in step_formset %}
            <div class="step-form mb-3 p-2 border rounded">
                <div class="form-group mb-2">
                    <label for="{{ step_form.step_number.id_for_label }}">Step number:</label>
                    {{ step_form.step_number }}
                </div>
                <div class="form-group mb-2">
                    <label for="{{ step_form.description.id_for_label }}">Description:</label>
                    {{ step_form.description }}
                </div>
                {{ step_form.id }}
                {{ step_form.DELETE }}
            </div>
        {% endfor %}
    </div>
    <button type="button" id="add-step" class="btn btn-secondary mt-2">Add Step</button>
</div>
        <div class="row mt-4">
            <div class="col-12">
                <button type="submit" class="btn btn-primary">Create Recipe</button>
            </div>
        </div>
    </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const favoriteBtn = document.getElementById('favoriteBtn');
    if (favoriteBtn) {
        favoriteBtn.addEventListener('click', function() {
            // Add AJAX call to toggle favorite status
            this.classList.toggle('btn-outline-primary');
            this.classList.toggle('btn-primary');
        });
    }
});

document.getElementById('add-step').addEventListener('click', function() {
    var formCount = parseInt(document.getElementById('id_step-TOTAL_FORMS').value);
    var newForm = document.getElementById('step-form-template').cloneNode(true);
    newForm.innerHTML = newForm.innerHTML.replace(/__prefix__/g, formCount);
    newForm.setAttribute('class', 'step-form mb-3 p-2 border rounded');
    document.querySelector('#step-formset').appendChild(newForm);
    document.getElementById('id_step-TOTAL_FORMS').value = formCount + 1;
});
</script>
{% endblock %}