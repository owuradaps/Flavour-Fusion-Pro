{% extends 'base.html' %}

{% block title %}{% if form.instance.pk %}Edit Recipe{% else %}Create Recipe{% endif %} - FlavourFusion{% endblock %}

{% block content %}
<h2>{% if form.instance.pk %}Edit Recipe{% else %}Create Recipe{% endif %}</h2>

{% if messages %}
<div class="messages">
    {% for message in messages %}
    <div{% if message.tags %} class="alert alert-{{ message.tags }}"{% endif %}>{{ message }}</div>
    {% endfor %}
</div>
{% endif %}

<form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    
    {% if form.non_field_errors %}
    <div class="alert alert-danger">
        {% for error in form.non_field_errors %}
        {{ error }}
        {% endfor %}
    </div>
    {% endif %}
    
    {{ form.as_p }}
    
    <h3>Ingredients</h3>
    {{ ingredient_formset.management_form }}
    <div id="ingredient-formset">
        {% for ingredient_form in ingredient_formset %}
            <div class="ingredient-form">
                {{ ingredient_form.as_p }}
            </div>
        {% endfor %}
    </div>
    <button type="button" id="add-ingredient" class="btn btn-secondary">Add Ingredient</button>

    <h3>Preparation Steps</h3>
    {{ step_formset.management_form }}
    <div id="step-formset">
        {% for step_form in step_formset %}
            <div class="step-form">
                {{ step_form.as_p }}
            </div>
        {% endfor %}
    </div>
    <button type="button" id="add-step" class="btn btn-secondary">Add Step</button>

    <button type="submit" class="btn btn-primary mt-3">Save Recipe</button>
</form>
{% endblock %}

{% block extra_js %}
<!-- Your existing JavaScript remains the same -->
{% endblock %}